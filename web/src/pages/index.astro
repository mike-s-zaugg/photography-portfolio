---
// web/src/pages/index.astro
import { sanityClient, urlFor } from '../lib/sanity';
import '../styles/global.css'; // <--- WICHTIG

// 1. GROQ Query: Hole alle Projekte, sortiert nach Datum
// Wir holen Titel, Slug und das Cover Image (inklusive Metadaten fÃ¼r BlurHash)
const query = `*[_type == "project"] | order(date desc) {
  title,
  "slug": slug.current,
  coverImage {
    asset->{
      _id,
      url,
      metadata { lqip }
    }
  }
}`;

const projects = await sanityClient.fetch(query);
---

<html lang="de">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Mein Foto Portfolio</title>
	</head>
	<body class="bg-black text-white antialiased">
    <nav class="border-b border-white/5 bg-black/40 backdrop-blur-md sticky top-0 z-40">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center">
        <span class="text-xs font-mono text-gray-500 uppercase tracking-widest">Portfolio</span>
      </div>
    </nav>
    
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
      <header class="mb-20">
        <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold mb-6 tracking-tight leading-tight text-white">
          Selected Works
        </h1>
        <p class="text-lg text-gray-400 max-w-2xl">Photography portfolio showcasing watch and product photography</p>
      </header>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
        
        {projects.map((project: any) => (
          <a href={`/project/${project.slug}`} class="group relative overflow-hidden rounded-lg aspect-square md:aspect-[4/5] bg-gray-900 shadow-xl hover:shadow-2xl transition-all duration-300">
            
            <img 
              src={urlFor(project.coverImage).width(800).height(800).url()} 
              alt={project.title}
              class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 ease-out"
              loading="lazy"
              style={`background-image: url(${project.coverImage.asset.metadata.lqip}); background-size: cover;`}
            />

            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/0 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-6">
              <h2 class="text-2xl font-semibold translate-y-2 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300">
                {project.title}
              </h2>
            </div>
          </a>
        ))}

      </div>
    </main>

	</body>
</html>